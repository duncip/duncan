---
title: Using scikit's pipeline for a Heart Attack classification model
description: Using a mix of R and Python for EDA and modelling
draft: true
author: Duncan
date: '2023-06-11'
slug: heart-attack-classification-pipeline
categories: [modeling, classification, python, r]
tags: [modeling, python, r]
editor_options: 
  chunk_output_type: console
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>Testing a pipeline for variety of classification models
<!--more--></p>
<ol style="list-style-type: decimal">
<li>Check data for nulls / types</li>
<li>Check imbalance of target variable</li>
<li>Check correlation between variables</li>
<li>Split dataset into train/test</li>
<li>Try model evaluation with no changes</li>
<li>. Build pipeline (try StandardScaler)</li>
</ol>
<pre><code>#&gt; # A tibble: 5 x 14
#&gt;     age   sex    cp trestbps  chol   fbs restecg thalach exang oldpeak slope
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1    52     1     0      125   212     0       1     168     0     1       2
#&gt; 2    53     1     0      140   203     1       0     155     1     3.1     0
#&gt; 3    70     1     0      145   174     0       1     125     1     2.6     0
#&gt; 4    61     1     0      148   203     0       1     161     0     0       2
#&gt; 5    62     0     0      138   294     1       1     106     0     1.9     1
#&gt; # ... with 3 more variables: ca &lt;dbl&gt;, thal &lt;dbl&gt;, target &lt;dbl&gt;</code></pre>
<p>The columns are as follows:</p>
<blockquote>
<ul>
<li>Age (age in years)</li>
<li>Sex (1 = male; 0 = female)</li>
<li>CP (chest pain type)</li>
<li>TRESTBPS (resting blood pressure (in mm Hg on admission to the hospital))</li>
<li>CHOL (serum cholestoral in mg/dl)</li>
<li>FPS (fasting blood sugar &gt; 120 mg/dl) (1 = true; 0 = false)</li>
<li>RESTECH (resting electrocardiographic results)</li>
<li>THALACH (maximum heart rate achieved)</li>
<li>EXANG (exercise induced angina (1 = yes; 0 = no))</li>
<li>OLDPEAK (ST depression induced by exercise relative to rest)</li>
<li>SLOPE (the slope of the peak exercise ST segment)</li>
<li>CA (number of major vessels (0-3) colored by flourosopy)</li>
<li>THAL (3 = normal; 6 = fixed defect; 7 = reversable defect)</li>
<li>TARGET (1 or 0)</li>
</ul>
</blockquote>
<p>Let’s have a look and see if there are null values and if anything weird jumps out with the distributions:</p>
<pre><code>#&gt;       age             sex               cp            trestbps    
#&gt;  Min.   :29.00   Min.   :0.0000   Min.   :0.0000   Min.   : 94.0  
#&gt;  1st Qu.:48.00   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:120.0  
#&gt;  Median :56.00   Median :1.0000   Median :1.0000   Median :130.0  
#&gt;  Mean   :54.43   Mean   :0.6956   Mean   :0.9424   Mean   :131.6  
#&gt;  3rd Qu.:61.00   3rd Qu.:1.0000   3rd Qu.:2.0000   3rd Qu.:140.0  
#&gt;  Max.   :77.00   Max.   :1.0000   Max.   :3.0000   Max.   :200.0  
#&gt;       chol          fbs            restecg          thalach     
#&gt;  Min.   :126   Min.   :0.0000   Min.   :0.0000   Min.   : 71.0  
#&gt;  1st Qu.:211   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:132.0  
#&gt;  Median :240   Median :0.0000   Median :1.0000   Median :152.0  
#&gt;  Mean   :246   Mean   :0.1493   Mean   :0.5298   Mean   :149.1  
#&gt;  3rd Qu.:275   3rd Qu.:0.0000   3rd Qu.:1.0000   3rd Qu.:166.0  
#&gt;  Max.   :564   Max.   :1.0000   Max.   :2.0000   Max.   :202.0  
#&gt;      exang           oldpeak          slope             ca        
#&gt;  Min.   :0.0000   Min.   :0.000   Min.   :0.000   Min.   :0.0000  
#&gt;  1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:1.000   1st Qu.:0.0000  
#&gt;  Median :0.0000   Median :0.800   Median :1.000   Median :0.0000  
#&gt;  Mean   :0.3366   Mean   :1.072   Mean   :1.385   Mean   :0.7541  
#&gt;  3rd Qu.:1.0000   3rd Qu.:1.800   3rd Qu.:2.000   3rd Qu.:1.0000  
#&gt;  Max.   :1.0000   Max.   :6.200   Max.   :2.000   Max.   :4.0000  
#&gt;       thal           target      
#&gt;  Min.   :0.000   Min.   :0.0000  
#&gt;  1st Qu.:2.000   1st Qu.:0.0000  
#&gt;  Median :2.000   Median :1.0000  
#&gt;  Mean   :2.324   Mean   :0.5132  
#&gt;  3rd Qu.:3.000   3rd Qu.:1.0000  
#&gt;  Max.   :3.000   Max.   :1.0000</code></pre>
<p>Thankfully with it being a Kaggle dataset, a lot of the cleaning etc. has already been done and there are no null values here. Additionally, the dataset has been updated so variables like sex and chest pain type are already numerically encoded which means we don’t have to do that. We’ll use a boxplot to see if there are outliers that jump out:</p>
<pre class="r"><code>heart_df %&gt;%
  select(age, trestbps, chol, thalach) %&gt;%
  reshape2::melt() %&gt;%
  ggplot() +
  geom_boxplot(aes(x = variable, y = value, colour = variable)) +
  facet_wrap(~variable, scales=&quot;free&quot;) +
  labs(title = &quot;Spotting outliers&quot;,
       x = NULL,
       y = NULL) +
  theme(legend.position = &quot;none&quot;)
#&gt; No id variables; using all as measure variables</code></pre>
<p><img src="/post/2023-06-11-heartattacks-scikitlearn-classification_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>We can see that <code>age</code> is fine but <code>trestbps</code>, <code>chol</code>, and <code>thalach</code> all have outliers that we need to be aware of. Not going to do anything to them yet but will see if changing those makes a difference to the model evaluation. Lastly I’ll check if there are obvious correlations between variables and if there’s a class imbalance for the target variable, and then on to the model!</p>
<pre class="r"><code>corrplot::corrplot(cor(heart_df, method=&quot;spearman&quot;))</code></pre>
<p><img src="/post/2023-06-11-heartattacks-scikitlearn-classification_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p><img src="/post/2023-06-11-heartattacks-scikitlearn-classification_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>All good here :)</p>
<div id="modelling" class="section level1">
<h1>Modelling</h1>
<p>Preferably we would’ve tried things like one hot encoding, filling null values etc. all in a single pipeline but because the dataset we’re working with is already great, we don’t need to do that. So instead, we’ll just do the scaling in the pipeline so we can easily switch between 3 models. For this, I’ll use Python</p>
<pre class="python"><code>import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split, cross_val_score
from sklearn.pipeline import make_pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import confusion_matrix, recall_score, precision_score, f1_score, accuracy_score
from sklearn.linear_model import LogisticRegression
from sklearn.neighbors import KNeighborsClassifier


heart_df_p = r.heart_df
heart_df_p.head()
#&gt;     age  sex   cp  trestbps   chol  ...  oldpeak  slope   ca  thal  target
#&gt; 0  52.0  1.0  0.0     125.0  212.0  ...      1.0    2.0  2.0   3.0     0.0
#&gt; 1  53.0  1.0  0.0     140.0  203.0  ...      3.1    0.0  0.0   3.0     0.0
#&gt; 2  70.0  1.0  0.0     145.0  174.0  ...      2.6    0.0  0.0   3.0     0.0
#&gt; 3  61.0  1.0  0.0     148.0  203.0  ...      0.0    2.0  1.0   3.0     0.0
#&gt; 4  62.0  0.0  0.0     138.0  294.0  ...      1.9    1.0  3.0   2.0     0.0
#&gt; 
#&gt; [5 rows x 14 columns]</code></pre>
<p>And then create a training/test split:</p>
<pre class="python"><code>X = heart_df_p.drop(&#39;target&#39;, axis=1)
y = heart_df_p[&#39;target&#39;]
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=4)</code></pre>
<pre class="python"><code>heart_df_p[&#39;target&#39;].shape
#&gt; (1025,)</code></pre>
</div>
